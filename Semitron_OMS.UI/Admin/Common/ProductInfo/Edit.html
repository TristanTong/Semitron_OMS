<script type="text/javascript">
    $(function () {
        debugger;
        var id = $("#hidSeletedProductInfoId").val(); //alert(id);
        $("#divEditProductInfo input[name='SeletedProductInfoId']").val(id);
        //新增时生成入库单号
        if (!id || id == "-1") {
            var url = "/Handle/Common/ProductInfoHandle.ashx";
            var data = { "meth": "GenerateCode" };
            var errorFun = function (x, e) {
                alertMsg.error(x.responseText);
            };
            var successFun = function (json) {
                if (!json || json.State == 0) {
                    alertMsg.error(json.Info);
                    $("#btnCloseProductInfo").click();
                    return false;
                } else {
                    $("#divEditProductInfo p input[name='ProductCode']").val(json.Info);
                    return true;
                }
            };
            JsAjax(url, data, successFun, errorFun);
        }

        //修改时加载初始化数据
        if (parseInt(id) > 0) {
            GetProductInfoById(id);
        }

        //根据Id获得入库单记录
        function GetProductInfoById(id) {
            try {
                var url = "/Handle/Common/ProductInfoHandle.ashx";
                var data = { "meth": "GetProductInfoById", "Id": id };
                var successFun = function (json) {
                    if (json.State == "0") {
                        alertMsg.error(json.Info);
                        $("#btnCloseProductInfo").click();
                        return false;
                    } else {
                        $("#divEditProductInfo p input[name='ProductCode']").val(json.ProductCode);
                        $("#divEditProductInfo p input[name='MPN']").val(json.MPN);
                        $("#divEditProductInfo p input[name='ProductInfo_Edit_SearchSupplier.SupplierID']").val(json.SupplierID);
                        $("#divEditProductInfo p input[name='ProductInfo_Edit_SearchSupplier.SCode']").val(json.SCode);
                        $("#divEditProductInfo p input[name='ProductInfo_Edit_SearchSupplier.SName']").val(json.SName);
                        return false;
                    }
                };
                var errorFun = function (x, e) {
                    alert(x.responseText);
                };
                JsAjax(url, data, successFun, errorFun);
            }
            catch (e) {
                alertMsg.error(e.message);
                $("#btnCloseProductInfo").click();
                return;
            }
        }
    });
</script>

<div class="pageContent">
    <form method="POST" action="/Handle/Common/ProductInfoHandle.ashx?meth=EditProductInfo" class="pageForm required-validate" onsubmit="return validateCallback(this, navTabAjaxDone);">
        <div class="pageFormContent nowrap" layouth="56" id="divEditProductInfo">
            <input name="SeletedProductInfoId" value="-1" type="hidden" />
            <p>
                <label>产品编码：</label>
                <input type="text" style="width: 110px" value="" name="ProductCode" minlength="3" class="required" readonly="readonly" />
            </p>
            <p>
                <label>厂商型号：</label>
                <input type="text" style="width: 110px" value="" name="MPN" minlength="3" class="required" />
            </p>
            <p>
                <label>默认供应商名称：</label>
                <input name="ProductInfo_Edit_SearchSupplier.SupplierID" value="" type="hidden" />
                <input name="ProductInfo_Edit_SearchSupplier.SName" type="text" style="width: 210px;" readonly="readonly" />
                <a class="btnLook" href="/Admin/CRM/Supplier/Lookup.html" lookupgroup="ProductInfo_Edit_SearchSupplier" rel="lSearchProductInfo_Edit_SearchSuppplier">查找带回</a>
            </p>
            <p>
                <label>默认供应商编码：</label>
                <input name="ProductInfo_Edit_SearchSupplier.SCode" type="text" style="width: 110px" readonly="readonly" />
            </p>
        </div>
        <div class="formBar">
            <ul>
                <li>
                    <div class="buttonActive">
                        <div class="buttonContent">
                            <button type="submit" id="btnSaveProductInfo">保存</button>
                        </div>
                    </div>
                </li>
                <li>
                    <div class="button">
                        <div class="buttonContent">
                            <button class="close" id="btnCloseProductInfo" type="button">关闭</button>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </form>
</div>
